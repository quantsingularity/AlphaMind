apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.appName }}-config
  namespace: {{ .Values.namespace | default "alphamind-prod" }}
  annotations:
    description: "Application configuration with security and compliance settings"
    compliance.alphamind.io/pci-dss: "true"
    compliance.alphamind.io/gdpr: "true"
    compliance.alphamind.io/sox: "true"
    compliance.alphamind.io/nist-csf: "true"
    compliance.alphamind.io/iso-27001: "true"
  labels:
    app: {{ .Values.appName }}
    component: config
    security.alphamind.io/classification: "internal"
data:
  # Application Configuration
  API_URL: {{ .Values.backend.apiUrl }}
  REDIS_HOST: {{ .Values.appName }}-redis
  REDIS_PORT: "{{ .Values.redis.containerPort }}"
  DATABASE_HOST: {{ .Values.appName }}-database
  DATABASE_PORT: "{{ .Values.database.containerPort }}"
  DATABASE_NAME: {{ .Values.database.name }}
  DATABASE_USER: {{ .Values.database.user }}
  LOG_LEVEL: {{ .Values.logLevel }}
  
  # Security Configuration
  ENABLE_ENCRYPTION: "true"
  ENCRYPTION_ALGORITHM: "AES-256-GCM"
  TLS_MIN_VERSION: "1.2"
  ENABLE_CSRF_PROTECTION: "true"
  ENABLE_XSS_PROTECTION: "true"
  ENABLE_CONTENT_SECURITY_POLICY: "true"
  SESSION_TIMEOUT: "900"
  PASSWORD_MIN_LENGTH: "12"
  ENABLE_MFA: "true"
  
  # Compliance Configuration
  AUDIT_ENABLED: "true"
  AUDIT_LOG_RETENTION_DAYS: "2555"  # 7 years for financial compliance
  DATA_RETENTION_POLICY: "7-years"
  GDPR_COMPLIANCE_MODE: "strict"
  PCI_DSS_COMPLIANCE: "true"
  SOX_COMPLIANCE: "true"
  
  # Monitoring and Alerting
  ENABLE_METRICS: "true"
  METRICS_PORT: "9090"
  HEALTH_CHECK_INTERVAL: "30"
  ENABLE_DISTRIBUTED_TRACING: "true"
  LOG_FORMAT: "json"
  LOG_DESTINATION: "stdout"
  
  # Rate Limiting
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_REQUESTS_PER_MINUTE: "100"
  RATE_LIMIT_BURST_SIZE: "20"
  
  # Database Security
  DATABASE_SSL_MODE: "require"
  DATABASE_CONNECTION_TIMEOUT: "30"
  DATABASE_MAX_CONNECTIONS: "100"
  DATABASE_IDLE_TIMEOUT: "300"
  
  # Redis Security
  REDIS_AUTH_ENABLED: "true"
  REDIS_SSL_ENABLED: "true"
  REDIS_CONNECTION_TIMEOUT: "10"
  
  # Backup Configuration
  BACKUP_ENABLED: "true"
  BACKUP_SCHEDULE: "0 2 * * *"  # Daily at 2 AM
  BACKUP_RETENTION_DAYS: "2555"  # 7 years
  BACKUP_ENCRYPTION_ENABLED: "true"
  
  # Network Security
  ALLOWED_ORIGINS: {{ .Values.security.allowedOrigins | default "*" }}
  TRUSTED_PROXIES: {{ .Values.security.trustedProxies | default "10.0.0.0/8,172.16.0.0/12,192.168.0.0/16" }}
  
  # Feature Flags
  ENABLE_API_VERSIONING: "true"
  ENABLE_REQUEST_VALIDATION: "true"
  ENABLE_RESPONSE_COMPRESSION: "true"
  ENABLE_CORS: "true"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.appName }}-security-config
  namespace: {{ .Values.namespace | default "alphamind-prod" }}
  annotations:
    description: "Security-specific configuration for compliance frameworks"
  labels:
    app: {{ .Values.appName }}
    component: security-config
    security.alphamind.io/classification: "internal"
data:
  # PCI DSS Configuration
  pci_dss_config.json: |
    {
      "version": "4.0",
      "requirements": {
        "firewall_protection": true,
        "default_passwords_changed": true,
        "cardholder_data_protection": true,
        "encrypted_transmission": true,
        "antivirus_protection": true,
        "secure_systems": true,
        "access_control": true,
        "unique_ids": true,
        "physical_access_restriction": true,
        "network_monitoring": true,
        "security_testing": true,
        "information_security_policy": true
      },
      "compliance_level": "Level 1",
      "assessment_date": "{{ now | date "2006-01-02" }}",
      "next_assessment": "{{ now | date_modify "+1y" | date "2006-01-02" }}"
    }
  
  # GDPR Configuration
  gdpr_config.json: |
    {
      "version": "2018",
      "data_protection_principles": {
        "lawfulness": true,
        "purpose_limitation": true,
        "data_minimization": true,
        "accuracy": true,
        "storage_limitation": true,
        "integrity_confidentiality": true,
        "accountability": true
      },
      "data_subject_rights": {
        "right_to_access": true,
        "right_to_rectification": true,
        "right_to_erasure": true,
        "right_to_restrict_processing": true,
        "right_to_data_portability": true,
        "right_to_object": true
      },
      "breach_notification_hours": 72,
      "dpo_required": true
    }
  
  # SOX Configuration
  sox_config.json: |
    {
      "version": "2002",
      "sections": {
        "302": {
          "description": "Corporate Responsibility for Financial Reports",
          "implemented": true
        },
        "404": {
          "description": "Management Assessment of Internal Controls",
          "implemented": true,
          "controls": {
            "access_controls": true,
            "change_management": true,
            "data_integrity": true,
            "segregation_of_duties": true,
            "backup_recovery": true,
            "monitoring_logging": true
          }
        },
        "906": {
          "description": "Corporate Responsibility for Financial Reports (Criminal Penalties)",
          "implemented": true
        }
      },
      "audit_frequency": "annual",
      "documentation_required": true
    }
  
  # NIST CSF Configuration
  nist_csf_config.json: |
    {
      "version": "2.0",
      "core_functions": {
        "identify": {
          "asset_management": true,
          "business_environment": true,
          "governance": true,
          "risk_assessment": true,
          "risk_management_strategy": true
        },
        "protect": {
          "access_control": true,
          "awareness_training": true,
          "data_security": true,
          "information_protection": true,
          "maintenance": true,
          "protective_technology": true
        },
        "detect": {
          "anomalies_events": true,
          "security_monitoring": true,
          "detection_processes": true
        },
        "respond": {
          "response_planning": true,
          "communications": true,
          "analysis": true,
          "mitigation": true,
          "improvements": true
        },
        "recover": {
          "recovery_planning": true,
          "improvements": true,
          "communications": true
        }
      },
      "implementation_tier": "Tier 3 - Repeatable",
      "profile_priority": "High"
    }
  
  # ISO 27001 Configuration
  iso_27001_config.json: |
    {
      "version": "2022",
      "annex_a_controls": {
        "information_security_policies": true,
        "organization_of_information_security": true,
        "human_resource_security": true,
        "asset_management": true,
        "access_control": true,
        "cryptography": true,
        "physical_environmental_security": true,
        "operations_security": true,
        "communications_security": true,
        "system_acquisition_development_maintenance": true,
        "supplier_relationships": true,
        "information_security_incident_management": true,
        "information_security_business_continuity": true,
        "compliance": true
      },
      "isms_scope": "AlphaMind Trading Platform",
      "risk_assessment_method": "ISO 27005",
      "certification_body": "TBD",
      "audit_frequency": "annual"
    }
